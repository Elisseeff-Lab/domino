<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="domino2">
<title>Cell Cell Communication with Domino2: v0.2.1 Vignette • domino2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cell Cell Communication with Domino2: v0.2.1 Vignette">
<meta property="og:description" content="domino2">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">domino2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/domino_object_vignette.html">domino_object_vignette</a>
    <a class="dropdown-item" href="../articles/plotting_vignette.html">plotting_vignette</a>
    <a class="dropdown-item" href="../articles/vignette.html">Cell Cell Communication with Domino2: v0.2.1 Vignette</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Elisseeff-Lab/domino/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Cell Cell Communication with Domino2: v0.2.1 Vignette</h1>
                        <h4 data-toc-skip class="author">Jacob Mitchell</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Elisseeff-Lab/domino/blob/HEAD/vignettes/vignette.Rmd" class="external-link"><code>vignettes/vignette.Rmd</code></a></small>
      <div class="d-none name"><code>vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-to-using-domino2-for-cell-cell-communication-inference">Introduction to using Domino2 for cell-cell communication inference<a class="anchor" aria-label="anchor" href="#introduction-to-using-domino2-for-cell-cell-communication-inference"></a>
</h2>
<div class="section level3">
<h3 id="preprocessing-scrnaseq-data">Preprocessing scRNAseq data<a class="anchor" aria-label="anchor" href="#preprocessing-scrnaseq-data"></a>
</h3>
<p>Domino2 is a tool for analysis of intra- and intercellular signaling in single cell RNA sequencing data based on transcription factor activation. This vignette is intended to demonstrate the basic pipeline for generating communication networks as a domino object using single cell RNA sequencing(scRNAseq) data.</p>
<p>Analysis of cell-cell communication (CCC) with Domino2 often follows initial pre-processing and annotation of scRNAseq data. This vignette will demonstrate how to use Domino2 on the 10X Genomics Peripheral Blood Mononuclear Cells (PBMC) data set of 2,700 cells and processed following the <a href="https://satijalab.org/seurat/articles/pbmc3k_tutorial" class="external-link">Satija Lab’s Seurat tutorial</a>. The data can be downloaded <a href="https://cf.10xgenomics.com/samples/cell/pbmc3k/pbmc3k_filtered_gene_bc_matrices.tar.gz" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Preprocessing of PBMC 3K tutorial data set</span></span>
<span><span class="va">pbmc.data</span> <span class="op">&lt;-</span> <span class="fu">Read10X</span><span class="op">(</span>data.dir <span class="op">=</span> <span class="st">"../data/pbmc3k_filtered_gene_bc_matrices"</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu">CreateSeuratObject</span><span class="op">(</span>counts <span class="op">=</span> <span class="va">pbmc.data</span>, project <span class="op">=</span> <span class="st">"pbmc3k"</span>, min.cells <span class="op">=</span> <span class="fl">3</span>, min.features <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">pbmc</span><span class="op">[[</span><span class="st">"percent.mt"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">PercentageFeatureSet</span><span class="op">(</span><span class="va">pbmc</span>, pattern <span class="op">=</span> <span class="st">"^MT-"</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu">NormalizeData</span><span class="op">(</span><span class="va">pbmc</span>, normalization.method <span class="op">=</span> <span class="st">"LogNormalize"</span>, scale.factor <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu">FindVariableFeatures</span><span class="op">(</span><span class="va">pbmc</span>, selection.method <span class="op">=</span> <span class="st">"vst"</span>, nfeatures <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu">ScaleData</span><span class="op">(</span><span class="va">pbmc</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu">RunPCA</span><span class="op">(</span><span class="va">pbmc</span>, features <span class="op">=</span> <span class="fu">VariableFeatures</span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu">FindNeighbors</span><span class="op">(</span><span class="va">pbmc</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu">FindClusters</span><span class="op">(</span><span class="va">pbmc</span>, resolution <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu">RunUMAP</span><span class="op">(</span><span class="va">pbmc</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Annotate clusters with cell phenotypes</span></span>
<span><span class="va">cell_dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span>,</span>
<span>  cell_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"naive_CD4_T_cell"</span>, <span class="st">"CD14_monocyte"</span>, <span class="st">"memory_CD4_T_cell"</span>, <span class="st">"B_cell"</span>, <span class="st">"CD8_T_cell"</span>, <span class="st">"CD16_monocyte"</span>, <span class="st">"NK_cell"</span>, <span class="st">"dendritic_cell"</span>, <span class="st">"platelet"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pbmc</span><span class="op">$</span><span class="va">cell_type</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html" class="external-link">mapvalues</a></span><span class="op">(</span></span>
<span>    <span class="va">pbmc</span><span class="op">$</span><span class="va">seurat_clusters</span>,</span>
<span>    from <span class="op">=</span> <span class="va">cell_dict</span><span class="op">$</span><span class="va">cluster</span>,</span>
<span>    to <span class="op">=</span> <span class="va">cell_dict</span><span class="op">$</span><span class="va">cell_type</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="saving-preprocessed-data">Saving Preprocessed Data:<a class="anchor" aria-label="anchor" href="#saving-preprocessed-data"></a>
</h4>
<p>Domino2 was designed to be compatible with <a href="https://satijalab.org/seurat" class="external-link">Seurat</a> objects in addition to accepting matrices and vectors of the data set as function inputs. Therefore, it’s a good idea to save the processed <a href="https://satijalab.org/seurat" class="external-link">Seurat</a> object for further analysis. However, <a href="https://pyscenic.readthedocs.io/en/latest/" class="external-link">pySCENIC</a> is used for transcription factor activation inference, and it requires as input a cell by gene matrix. This is the opposite orientation of <a href="https://satijalab.org/seurat" class="external-link">Seurat</a> objects but is the default for Python based tools such as <a href="https://scanpy.readthedocs.io/en/stable/" class="external-link">scanpy</a>. Saving our data as a loom file using <a href="https://github.com/mojaveazure/loomR" class="external-link">loomR</a> will be helpful for that step and is therefore recommended as well.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save Seurat object as RDS</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">pbmc</span>, file <span class="op">=</span> <span class="st">"../data/pbmc3k_seurat.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save loom counts matrix</span></span>
<span><span class="va">pbmc_counts</span> <span class="op">&lt;-</span> <span class="va">pbmc</span><span class="op">@</span><span class="va">assays</span><span class="op">$</span><span class="va">RNA</span><span class="op">@</span><span class="va">counts</span></span>
<span><span class="va">pbmc_loom</span> <span class="op">&lt;-</span> <span class="fu">loomR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/loomR/man/create.html" class="external-link">create</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"../data/pbmc3k_counts.loom"</span>, data <span class="op">=</span> <span class="va">pbmc_counts</span><span class="op">)</span></span>
<span><span class="va">pbmc_loom</span><span class="op">$</span><span class="fu">close_all</span><span class="op">(</span><span class="op">)</span> <span class="co"># Remember to manually close connection to loom files!</span></span></code></pre></div>
<p>The cell x gene counts matrix may also be saved as a tab-separated value (.tsv) file if <a href="https://github.com/mojaveazure/loomR" class="external-link">loomR</a> cannot be used on your computing resource, but be aware that dense formatting of a .tsv can lead to very large file sizes and slow processing for large data sets. We have provided the necessary code below, but due to the large file size, this .tsv file is not provided in our data directory.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc_counts</span> <span class="op">&lt;-</span> <span class="va">pbmc</span><span class="op">@</span><span class="va">assays</span><span class="op">$</span><span class="va">RNA</span><span class="op">@</span><span class="va">counts</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pbmc_counts</span><span class="op">)</span><span class="op">)</span>, <span class="st">"../data/pbmc3k_counts.tsv"</span>, </span>
<span>    sep <span class="op">=</span> <span class="st">"\t"</span>, col.names <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p>If you would like to skip ahead to the rest of the analysis, the processed objects from these steps are available in the data directory of this package.</p>
</div>
</div>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>Domino2 is undergoing active development where aspects of how data is used, analyzed, and interpreted is subject to change as new features and fixes are implemented. v0.2.1 of Domino2 serves as the first stable development version during these active updates for reproducible usage of implemented fixes to handling of receptors and ligands that function in heteromeric complexes, consideration of receptor expression on a per-cluster basis for linkage to transcription factors, and reformatting of receptor-ligand database and transcription factor regulon inputs enabling Domino2 to use alternative data bases and transcription factor activity inference methods.</p>
<p>This version is currently hosted on the <a href="https://github.com/FertigLab" class="external-link">FertigLab GitHub</a> as <a href="https://github.com/FertigLab/domino_development/tree/v0.2.1" class="external-link">branch v0.2.1</a> of the <a href="https://github.com/FertigLab/domino_development" class="external-link">domino_development repository</a> forked from the primary repository hosted on the <a href="https://github.com/Elisseeff-Lab/domino" class="external-link">Elisseeff-Lab GitHub</a>, and can be installed using the remotes package.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'remotes'</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">'FertigLab/domino_development@v0.2.1'</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="additional-downloads">Additional Downloads<a class="anchor" aria-label="anchor" href="#additional-downloads"></a>
</h4>
<p>For this tutorial, <a href="https://pyscenic.readthedocs.io/en/latest/" class="external-link">pySCENIC</a> is used as the method for transcription factor activity inference and the assessment of ligand-receptor interactions is based on curated interactions from <a href="https://github.com/ventolab/cellphonedb-data/releases/tag/v4.0.0" class="external-link">CellPhoneDB v4.0.0</a>. Each of these requires downloading some files prior to use in our analysis pipeline.</p>
<div class="section level5">
<h5 id="downloads-for-scenic">Downloads for SCENIC:<a class="anchor" aria-label="anchor" href="#downloads-for-scenic"></a>
</h5>
<p>A singularity image of SCENIC v0.12.1 can be installed from the DockerHub image as a source (example scripts for use with Docker are provided in the scenic_bash directory as well). SCENIC requires a list of transcription factors, motif annotations, and cisTarget motifs which are all available from the authors of SCENIC for human (HGNC), mouse (MGI), and fly. The following will download everything necessary for an analysis of a data set with HGNC gene labels for the hg38 genome.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a><span class="va">SCENIC_DIR=</span><span class="st">"scenic"</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">mkdir</span> <span class="va">${SCENIC_DIR}</span></span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># Build singularity image</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="ex">singularity</span> build <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/aertslab-pyscenic-0.12.1.sif"</span> docker://aertslab/pyscenic:0.12.1</span>
<span id="cb5-6"><a href="#cb5-6"></a></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co"># Matrix containing motifs as rows and genes as columns and ranking position for each gene and motif (based on CRM scores) as values</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="ex">curl</span> <span class="st">"https://resources.aertslab.org/cistarget/databases/old/homo_sapiens/hg38/refseq_r80/mc9nr/gene_based/hg38__refseq-r80__10kb_up_and_down_tss.mc9nr.feather"</span> \</span>
<span id="cb5-9"><a href="#cb5-9"></a>  -o <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/hg38__refseq-r80__10kb_up_and_down_tss.mc9nr.feather"</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="ex">curl</span> <span class="st">"https://resources.aertslab.org/cistarget/databases/old/homo_sapiens/hg38/refseq_r80/mc9nr/gene_based/hg38__refseq-r80__500bp_up_and_100bp_down_tss.mc9nr.feather"</span> \</span>
<span id="cb5-11"><a href="#cb5-11"></a>  -o <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/hg38__refseq-r80__500bp_up_and_100bp_down_tss.mc9nr.feather"</span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co"># List of genes encoding transcription factors in the HG38 reference genome</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="ex">curl</span> <span class="st">"https://resources.aertslab.org/cistarget/tf_lists/allTFs_hg38.txt"</span> \</span>
<span id="cb5-14"><a href="#cb5-14"></a>  -o <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/allTFs_hg38.txt"</span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co"># Motif annotations based on the 2017 cisTarget motif collection. Use these files if you are using the mc9nr databases.</span></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="ex">curl</span> <span class="st">"https://resources.aertslab.org/cistarget/motif2tf/motifs-v9-nr.hgnc-m0.001-o0.0.tbl"</span> \</span>
<span id="cb5-17"><a href="#cb5-17"></a>  -o <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/motifs-v9-nr.hgnc-m0.001-o0.0.tbl"</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="downloads-for-cellphonedb">Downloads for CellPhoneDB:<a class="anchor" aria-label="anchor" href="#downloads-for-cellphonedb"></a>
</h5>
<p>Database files from <a href="https://github.com/ventolab/cellphonedb-data/releases/tag/v4.0.0" class="external-link">CellPhoneDB v4.0.0</a> for human scRNA-seq data can be installed from a public github repository from the Tiechmann Group that developed CellPhoneDB.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a><span class="va">CELLPHONE_DIR=</span><span class="st">"cellphonedb"</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="fu">mkdir</span> <span class="va">${CELLPHONE_DIR}</span></span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># Annotation of protein complexes</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="ex">curl</span> <span class="st">"https://raw.githubusercontent.com/Teichlab/cellphonedb-data/master/data/complex_input.csv"</span> \</span>
<span id="cb6-6"><a href="#cb6-6"></a>  -o <span class="st">"</span><span class="va">${CELLPHONE_DIR}</span><span class="st">/complex_input.csv"</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co"># Annotation of genes encoding database proteins</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="ex">curl</span> <span class="st">"https://raw.githubusercontent.com/Teichlab/cellphonedb-data/master/data/gene_input.csv"</span> \</span>
<span id="cb6-9"><a href="#cb6-9"></a>  -o <span class="st">"</span><span class="va">${CELLPHONE_DIR}</span><span class="st">/gene_input.csv"</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co"># Annotated protein interactions</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="ex">curl</span> <span class="st">"https://raw.githubusercontent.com/Teichlab/cellphonedb-data/master/data/interaction_input.csv"</span> \</span>
<span id="cb6-12"><a href="#cb6-12"></a>  -o <span class="st">"</span><span class="va">${CELLPHONE_DIR}</span><span class="st">/interaction_input.csv"</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co"># Annotated protein features</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="ex">curl</span> <span class="st">"https://raw.githubusercontent.com/Teichlab/cellphonedb-data/master/data/protein_input.csv"</span> \</span>
<span id="cb6-15"><a href="#cb6-15"></a>  -o <span class="st">"</span><span class="va">${CELLPHONE_DIR}</span><span class="st">/protein_input.csv"</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="scenic-analysis">SCENIC Analysis<a class="anchor" aria-label="anchor" href="#scenic-analysis"></a>
</h3>
<p>SCENIC is our lab’s preferred software for transcription factor activity scoring. We recommend using the Python implementation (pySCENIC) as it is faster than the original R implementation. Be aware, the use of SCENIC is often the slowest and most memory intensive step of this analysis pipeline. SCENIC should be run on computing resources with access to multi-core processing and large amounts of memory.</p>
<p>As described in the section on saving preprocessed data, SCENIC requires RNA counts to be provided in a cell by gene matrix format, so we will be using the pbmc3k_counts.loom file in this stage of analysis.</p>
<p>pySCENIC is initiated using bash scripting in the terminal. The analysis consists of 3 steps to score genes for transcription factor motif enrichment, construct transcription factor regulons consisting of genes targeted by the transcription factors, and arrive at AUC scores for enrichment of regulon gene transcription within each cell.</p>
<div class="section level4">
<h4 id="grn-construct-tf-modules">grn: construct TF-modules<a class="anchor" aria-label="anchor" href="#grn-construct-tf-modules"></a>
</h4>
<p>Co-expression modules are used to quantify gene-transciption factor adjacencies.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a><span class="ex">singularity</span> exec <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/aertslab-pyscenic-0.12.1.sif"</span> pyscenic grn \</span>
<span id="cb7-2"><a href="#cb7-2"></a>    <span class="st">"../data/pbmc3k_counts.loom"</span> <span class="dt">\ </span>        <span class="co"># path to the loom file</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/allTFs_hg38.txt"</span> <span class="ex">\ </span>                       <span class="co"># list of transcription factors </span></span>
<span id="cb7-4"><a href="#cb7-4"></a>    <span class="ex">-o</span> <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/pbmc_adj.tsv"</span> <span class="dt">\ </span>                       <span class="co"># output directory for the adjacency matrix</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="ex">--num_workers</span> 6 <span class="dt">\ </span>                                <span class="co"># number of CPUs to use if multi-core processing is available</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>    <span class="ex">--set_seed</span> 123                                    <span class="co"># specify a random seed for reproducibility</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="ctx-construct-tf-regulons-with-pruning-based-on-tf-motiff-enrichment">ctx: construct TF regulons with pruning based on TF motiff enrichment<a class="anchor" aria-label="anchor" href="#ctx-construct-tf-regulons-with-pruning-based-on-tf-motiff-enrichment"></a>
</h4>
<p>The rankings of genes based on enrichment of transcription factor motiffs to the transcription start site (TSS) are considered in the construction of regulons, where target genes in the TF-modules are removed if they lack motifs proximal to the TSS where the transcription factor may bind.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1"></a><span class="ex">singularity</span> exec <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/aertslab-pyscenic-0.12.1.sif"</span> pyscenic ctx \</span>
<span id="cb8-2"><a href="#cb8-2"></a>    <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/pbmc_adj.tsv"</span> <span class="dt">\ </span>                                                  <span class="co"># adjacency matrix output from grn</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>    <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/hg38__refseq-r80__10kb_up_and_down_tss.mc9nr.feather"</span> <span class="ex">\ </span>          <span class="co"># target rankings of motif enrichment within 10 kb of TSS</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>    <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/hg38__refseq-r80__500bp_up_and_100bp_down_tss.mc9nr.feather"</span> <span class="ex">\ </span>   <span class="co"># target rankings of motif enrichment within 500 bp upstream and 100 bp downstream of TSS</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="ex">--annotations_fname</span> <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/motifs-v9-nr.hgnc-m0.001-o0.0.tbl"</span> <span class="dt">\ </span>         <span class="co"># TF motif features</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>    <span class="ex">--expression_mtx_fname</span> <span class="st">"../data/pbmc3k_counts.loom"</span> <span class="dt">\ </span>         <span class="co"># counts matrix loom file</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>    <span class="ex">--mode</span> <span class="st">"dask_multiprocessing"</span> <span class="dt">\ </span>                                          <span class="co"># enable multi-core processing</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>    <span class="ex">--output</span> <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/pbmc_regulons.csv"</span> <span class="dt">\ </span>                                    <span class="co"># output file of learned TF regulons</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>    <span class="ex">--num_workers</span> 6                                                           <span class="co"># number of CPU cores</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="aucell-calculate-tf-activity-scores">aucell: calculate TF activity scores<a class="anchor" aria-label="anchor" href="#aucell-calculate-tf-activity-scores"></a>
</h4>
<p>Enrichment of a regulon is measured as the Area Under the recovery Curve (AUC) of the genes that define this regulon.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1"></a><span class="ex">singularity</span> exec <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/aertslab-pyscenic-0.12.1.sif"</span> pyscenic aucell \</span>
<span id="cb9-2"><a href="#cb9-2"></a>    <span class="st">"../data/pbmc3k_counts.loom"</span> <span class="dt">\ </span>  <span class="co"># counts matrix loom file</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/pbmc_regulons.csv"</span> <span class="ex">\ </span>               <span class="co"># regulon table output from ctx</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="ex">-o</span> <span class="st">"</span><span class="va">${SCENIC_DIR}</span><span class="st">/pbmc_auc.csv"</span>                    <span class="co"># cell x TF matrix of TF enrichment AUC values</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="building-a-signaling-network-with-domino2">Building a Signaling Network with Domino2<a class="anchor" aria-label="anchor" href="#building-a-signaling-network-with-domino2"></a>
</h3>
<div class="section level4">
<h4 id="loading-scenic-results">Loading SCENIC Results<a class="anchor" aria-label="anchor" href="#loading-scenic-results"></a>
</h4>
<p>The transcription factor activities are a required input for Domino2, and the regulons learned by SCENIC are an important but optional input needed to annotate transcription factor-target interactions and to prune transcription factor-receptor linkages where the receptor is a target of the transcription factor. This prevents the distinction of receptor expression driving transcription factor activity or the transcription factor inducing the receptor’s expression.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scenic_dir</span> <span class="op">=</span> <span class="st">"scenic/"</span></span>
<span><span class="va">regulons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">scenic_dir</span>, <span class="st">"/pbmc_regulons.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">auc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">scenic_dir</span>, <span class="st">"scenic/pbmc_auc.csv"</span><span class="op">)</span>,</span>
<span>                  header <span class="op">=</span> <span class="cn">TRUE</span>, row.names <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span></code></pre></div>
<p>The initial regulons data frame read into R from the ctx function has 2 rows of column names that need to be replaced with one succinct description. Domino2 has changed the input format for transcription factor regulons to be a list storing vectors of target genes in each regulon, where the names of the list are the transcription factor genes. This facilitates the use of alternative methods for transcription factor activity quantification methods. We provide a helper function for easy retreival of transcription factor regulons from the output of the pySCENIC ctx function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regulons</span> <span class="op">&lt;-</span> <span class="va">regulons</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="op">-</span><span class="fl">2</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">regulons</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TF"</span>, <span class="st">"MotifID"</span>, <span class="st">"AUC"</span>, <span class="st">"NES"</span>, <span class="st">"MotifSimilarityQvalue"</span>, <span class="st">"OrthologousIdentity"</span>, <span class="st">"Annotation"</span>, <span class="st">"Context"</span>, <span class="st">"TargetGenes"</span>, <span class="st">"RankAtMax"</span><span class="op">)</span></span>
<span><span class="va">regulon_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_regulon_list_scenic.html">create_regulon_list_scenic</a></span><span class="op">(</span>regulons <span class="op">=</span> <span class="va">regulons</span><span class="op">)</span></span></code></pre></div>
<p>Users should be aware that the AUC matrix from SCENIC is loaded in a cell x transcription factor orientation and should be transposed to transcription factor x cell orientation. pySCENIC also appends “(+)” to transcription factor names that are converted to “…” upon loading into R. These characters can be included without affecting the results of Domino2 analysis, but can be confusing when querying transcription factor features in the data. We recommend comprehensive removal of the “…” characters using the gsub() function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">auc_in</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">auc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">auc_in</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\.\\.\\.$"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">auc_in</span><span class="op">)</span><span class="op">)</span> <span class="co"># remove pattern "..." from the end of all rownames</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="load-cellphonedb-database">Load CellPhoneDB Database<a class="anchor" aria-label="anchor" href="#load-cellphonedb-database"></a>
</h4>
<p>Domino2 has been updated to read ligand-receptor data bases in a uniform data.frame format referred to as a receptor-ligand map (rl_map) to enable the use of alternative or updated reference databases as oppossed to a particular version of CellPhoneDB’s database in older versions of Domino. Each row corresponds to a ligand-receptor interaction. Genes participating in an interaction are referred to as “partner A” and “partner B” without a requirement for fixed ordering of whether A or B is the ligand and vice versa. The minimum required columns of this data frame are:</p>
<ul>
<li>int_pair: the names of the interacting ligand and receptor seperated by " &amp; "</li>
<li>gene_A: the gene or genes encoding partner A</li>
<li>gene_B: the gene or genes encoding partner B</li>
<li>type_A: (“L”, “R”) whether partner A is a ligand (“L”) or receptor (“R”)</li>
<li>type_B: (“L”, “R”) whether partner B is a ligand (“L”) or receptor (“R”)</li>
</ul>
<p>Additional annotation columns can be provided such as name_A and name_B for ligands or receptors whose name in the interaction database does not match the names of their encoding genes. This formatting also allows for the consideration of ligand and receptor complexes comprised of a heteromeric combination of multiple proteins that must be coexpressed to function. In these cases, the “name_*” column shows the name of the protein complex, and the “gene_*” column shows the names of the genes encoding the components of the complex separated by commas “,”. When plotting results from the build domino object, the names of the interacting ligands and receptors will be used based on combinatorial expression of the complex components.</p>
<p>To facilitate the use of this formatting with the CellPhoneDB database, we include a helper function that automatically parses files from the cellPhoneDB database to arrive at the rl_map format.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cellphonedb_2_path</span> <span class="op">&lt;-</span> <span class="st">"cellphonedb"</span></span>
<span><span class="va">complexes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">cellphonedb_2_path</span>, <span class="st">"/complex_input.csv"</span><span class="op">)</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">cellphonedb_2_path</span>, <span class="st">"/gene_input.csv"</span><span class="op">)</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">interactions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">cellphonedb_2_path</span>, <span class="st">"/interaction_input.csv"</span><span class="op">)</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">proteins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">cellphonedb_2_path</span>, <span class="st">"/protein_input.csv"</span><span class="op">)</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rl_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_rl_map_cellphonedb.html">create_rl_map_cellphonedb</a></span><span class="op">(</span></span>
<span>  genes <span class="op">=</span> <span class="va">genes</span>, </span>
<span>  proteins <span class="op">=</span> <span class="va">proteins</span>, </span>
<span>  interactions <span class="op">=</span> <span class="va">interactions</span>,</span>
<span>  complexes <span class="op">=</span> <span class="va">complexes</span>,</span>
<span>  database_name <span class="op">=</span> <span class="st">"CellPhoneDB_v4.0"</span> <span class="co"># includes database version used</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rl_map</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level5">
<h5 id="optional-adding-interactions-manually">Optional: Adding interactions manually<a class="anchor" aria-label="anchor" href="#optional-adding-interactions-manually"></a>
</h5>
<p>The change to use rl_map formatting also enables users to manually append interactions of interest that are not included in the interaction database if need be. This can be attained by formatting the desired interactions as a data.frame with the same column headers as the rl_map and using the rbind() function.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Integrin complexes are not annotated as receptors in CellPhoneDB_v4.0</span></span>
<span><span class="co"># collagen-integrin interactions between cells may be missed unless tables from the CellPhoneDB reference are edited or the interactions are manually added</span></span>
<span></span>
<span><span class="va">col_int_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="st">"int_pair"</span> <span class="op">=</span> <span class="st">"a11b1 complex &amp; COLA1_HUMAN"</span>,</span>
<span>  <span class="st">"name_A"</span> <span class="op">=</span> <span class="st">"a11b1 complex"</span>, <span class="st">"uniprot_A"</span> <span class="op">=</span> <span class="st">"P05556,Q9UKX5"</span>, <span class="st">"gene_A"</span> <span class="op">=</span> <span class="st">"ITB1,ITA11"</span>, <span class="st">"type_A"</span> <span class="op">=</span> <span class="st">"R"</span>,</span>
<span>  <span class="st">"name_B"</span> <span class="op">=</span> <span class="st">"COLA1_HUMAN"</span>, <span class="st">"uniprot_B"</span> <span class="op">=</span> <span class="st">"P02452,P08123"</span>, <span class="st">"gene_B"</span> <span class="op">=</span> <span class="st">"COL1A1,COL1A2"</span>, <span class="st">"type_B"</span> <span class="op">=</span> <span class="st">"L"</span>,</span>
<span>  <span class="st">"annotation_strategy"</span> <span class="op">=</span> <span class="st">"manual"</span>, <span class="st">"source"</span> <span class="op">=</span> <span class="st">"manual"</span>, <span class="st">"database_name"</span> <span class="op">=</span> <span class="st">"manual"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">rl_map_append</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">col_int_df</span>, <span class="va">rl_map</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rl_map_append</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="creating-the-domino-object">Creating the Domino Object<a class="anchor" aria-label="anchor" href="#creating-the-domino-object"></a>
</h3>
<p>Domino2 analysis takes place in two steps. 1. create_domino() a. initializes the domino result object b. assesses differential transcription factor activity across cell clusters by wilcoxon rank-sum test c. establishes transcription factor-receptor linkages based on Spearman correlation of transcription factor activities with receptor expression across the queried data set. 2. build_domino() a. sets the parameters for which transcription factors and receptors are called as active within a cell cluster b. aggregates the scaled expression of ligands capable of interacting with the active receptors for assessment of ligand type and cellular source triggering activation of a receptor.</p>
<div class="section level4">
<h4 id="required-inputs-from-data-set">Required inputs from data set<a class="anchor" aria-label="anchor" href="#required-inputs-from-data-set"></a>
</h4>
<p>Domino2 infers active receipt of signals via receptors based on the correlation of the receptor’s expression with transcription factor activity across the data set and differential activity of the transcription factor within a cell cluster. Correlations are conducted using scaled expression values rather than raw counts or normalized counts. For assessment of receptor activity on a per cell type basis, a named vector of cell cluster assignments, where the names are cell barcodes matching the expression matrix, are provided. Assessing signaling based on other categorical groupings of cells can be acheived by passing these groupings as “clusters” to build_domino() in place of cell types. Domino2 accepts either a <a href="https://satijalab.org/seurat" class="external-link">Seurat</a> object with counts, scaled counts, and clusters included, or it requires a matrix of counts, a matrix of scaled counts, and a named vector of cell cluster labels as factors. Shown below is how to extract these elements from a <a href="https://satijalab.org/seurat" class="external-link">Seurat</a> object.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="va">pbmc</span><span class="op">@</span><span class="va">assays</span><span class="op">$</span><span class="va">RNA</span><span class="op">@</span><span class="va">counts</span></span>
<span><span class="va">z_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">@</span><span class="va">assays</span><span class="op">$</span><span class="va">RNA</span><span class="op">@</span><span class="va">scale.data</span><span class="op">)</span></span>
<span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">$</span><span class="va">cell_type</span><span class="op">)</span></span></code></pre></div>
<p>Note: Ligand and receptor expression can only be assessed for genes included in the z_scores matrix. Many scRNA-seq analysis pipelines recommend storing only genes with high variance in scaled expression slots for these data objects, thereby missing many genes encoding ligands and receptors. <strong>Ensure that all your genes of interest are included in the rows of your z_scores matrix.</strong> Scaled expression was calculated for all genes in this PBMC data set after removal of genes expressed in less than 3 cells.</p>
</div>
<div class="section level4">
<h4 id="create-domino-object">Create Domino object<a class="anchor" aria-label="anchor" href="#create-domino-object"></a>
</h4>
<p>At this point, the create_domino() function can be used to make the object. Parameters of note include “use_clusters” which is required to assess signaling between cell types rather than linkage of transcription factors and receptors broadly across the data set. “use_complexes” decides if receptors that function in heteromeric complexes will be considered in testing linkages between transcription factors and receptors. If TRUE, a receptor complex is only linked to a transcription factor if a majority of the component genes meet the Spearman correlation threshold. “remove_rec_dropout” decides whether receptor values of 0 will be considered in correlation calculations; this measure is intended to reduce the effect of dropout on receptors wiht low expression.</p>
<p>To run create_domino() with matrix and vector inputs:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc_dom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_domino.html">create_domino</a></span><span class="op">(</span></span>
<span>  rl_map <span class="op">=</span> <span class="va">rl_map</span>,             <span class="co"># receptor-ligand map data frame</span></span>
<span>  features <span class="op">=</span> <span class="va">auc_in</span>,           <span class="co"># Transcription factor scores (AUC matrix)</span></span>
<span>  counts <span class="op">=</span> <span class="va">counts</span>,             <span class="co"># counts matrix</span></span>
<span>  z_scores <span class="op">=</span> <span class="va">z_scores</span>,         <span class="co"># scaled expression data</span></span>
<span>  clusters <span class="op">=</span> <span class="va">clusters</span>,         <span class="co"># vector of cell cluster assignments</span></span>
<span>  tf_targets <span class="op">=</span> <span class="va">regulon_list</span>,   <span class="co"># list of TFs and their reglons</span></span>
<span>  use_clusters <span class="op">=</span> <span class="cn">TRUE</span>,         <span class="co"># assess receptor activation and ligand expression on a per-cluster basis</span></span>
<span>  use_complexes <span class="op">=</span> <span class="cn">TRUE</span>,        <span class="co"># include receptors and genes that function as a complex in results</span></span>
<span>  remove_rec_dropout <span class="op">=</span> <span class="cn">FALSE</span>   <span class="co"># whether to remove zeroes from correlation calculations</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The above results will be equivalent to using the <a href="https://satijalab.org/seurat" class="external-link">Seurat</a> object directly. Note that inclusion of both the matrix inputs and the <a href="https://satijalab.org/seurat" class="external-link">Seurat</a> object will prioritize the <a href="https://satijalab.org/seurat" class="external-link">Seurat</a> objects.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc_dom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_domino.html">create_domino</a></span><span class="op">(</span></span>
<span>  rl_map <span class="op">=</span> <span class="va">rl_map</span>,             <span class="co"># receptor-ligand map data frame</span></span>
<span>  features <span class="op">=</span> <span class="va">auc_in</span>,           <span class="co"># Transcription factor scores (AUC matrix)</span></span>
<span>  ser <span class="op">=</span> <span class="va">pbmc</span>,                  <span class="co"># Seurat object containing counts, scaled counts, and cell cluster assignments</span></span>
<span>  tf_targets <span class="op">=</span> <span class="va">regulon_list</span>,   <span class="co"># list of TFs and their reglons</span></span>
<span>  use_clusters <span class="op">=</span> <span class="cn">TRUE</span>,         <span class="co"># assess receptor activation and ligand expression on a per-cluster basis</span></span>
<span>  use_complexes <span class="op">=</span> <span class="cn">TRUE</span>,        <span class="co"># include receptors and genes that function as a complex in results</span></span>
<span>  remove_rec_dropout <span class="op">=</span> <span class="cn">FALSE</span>   <span class="co"># whether to remove zeroes from correlation calculations</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For information on what is stored in a domino object and how to access it, please see our vignette on the structure of domino objects.</p>
</div>
<div class="section level4">
<h4 id="build-domino">Build Domino<a class="anchor" aria-label="anchor" href="#build-domino"></a>
</h4>
<p>build_domino() finalizes the construction of the domino object by setting parameters for identifying transcription factors with differential activation between clusters, receptor linkage with transcription factors based on magnitude of positive correlation, and the minimum percentage of cells within a cluster that have expression of a receptor for the receptor to be called as active.</p>
<p>There are also options for thresholds of the number of transcription factors that may be called active in a cluster and the number of receptors that may be linked to any one transcription factor. For thresholds of n transcription factors and m receptors, the bottom n transcription factors by lowest p-values from the wilcoxon rank sum test and the top m receptors by Spearman correlation coefficient are chosen.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc_dom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_domino.html">build_domino</a></span><span class="op">(</span></span>
<span>  dom <span class="op">=</span> <span class="va">pbmc_dom</span>,</span>
<span>  min_tf_pval <span class="op">=</span> <span class="fl">.001</span>, <span class="co"># Threshold for p-value of DE for TFs</span></span>
<span>  max_tf_per_clust <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  max_rec_per_tf <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  rec_tf_cor_threshold <span class="op">=</span> <span class="fl">.25</span>, <span class="co"># Minimum correlation between receptor and TF</span></span>
<span>  min_rec_percentage <span class="op">=</span> <span class="fl">0.1</span> <span class="co"># Minimum percent of cells that must express receptor</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Both of the thresholds for the number of receptors and transcription factors can be sent to infinity (Inf) to collect all receptors and transcription factors that meet statistical significance thresholds.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dom_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_domino.html">build_domino</a></span><span class="op">(</span></span>
<span>  dom <span class="op">=</span> <span class="va">dom</span>,</span>
<span>  min_tf_pval <span class="op">=</span> <span class="fl">.001</span>,</span>
<span>  max_tf_per_clust <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  max_rec_per_tf <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  rec_tf_cor_threshold <span class="op">=</span> <span class="fl">.25</span>,</span>
<span>  min_rec_percentage <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="visualization-of-domino-results">Visualization of Domino Results<a class="anchor" aria-label="anchor" href="#visualization-of-domino-results"></a>
</h3>
<p>Multiple functions are available to visualize the intracellular networks between receptors and transcription factors and the ligand-receptor mediated intercellular networks between cell types.</p>
<div class="section level4">
<h4 id="summarize-transcription-factor-activity-and-linkage">Summarize Transcription Factor Activity and Linkage<a class="anchor" aria-label="anchor" href="#summarize-transcription-factor-activity-and-linkage"></a>
</h4>
<p>Enrichment of transcription factor activities by cell types can be visualized by feat_heatmap() which plots data set-wide transcription factor activity scores as a pheatmap. The mark_connections argument determines whether an X is used to mark linked transcription factors and receptors.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/feat_heatmap.html">feat_heatmap</a></span><span class="op">(</span><span class="va">pbmc_dom</span>, norm <span class="op">=</span> <span class="cn">TRUE</span>, bool <span class="op">=</span> <span class="cn">FALSE</span>, mark_connections <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="cumulative-signaling-between-cell-types">Cumulative signaling between cell types<a class="anchor" aria-label="anchor" href="#cumulative-signaling-between-cell-types"></a>
</h4>
<p>The cummulative degree of signaling between clusters is assessed as the sum of the scaled expressin of ligands targeting active receptors on another cluster. This can be visualized in graph format using the signaling_network() function. Nodes represent each cell cluster and edges scale with the magnitude of signaling between the clusters. The color of the edge corresponds to the sender cluster for that signal.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/signaling_network.html">signaling_network</a></span><span class="op">(</span><span class="va">pbmc_dom</span>, edge_weight <span class="op">=</span> <span class="fl">.5</span>, max_thresh <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span></code></pre></div>
<p>Signaling networks can also be drawn with the edges only render the signals directed towards a given cell type or signals from one cell type directed to others can also be created. To see those options in use, as well as other plotting options, please see our plotting vignette.</p>
</div>
<div class="section level4">
<h4 id="specific-signaling-interactions-between-clusters">Specific Signaling Interactions between Clusters<a class="anchor" aria-label="anchor" href="#specific-signaling-interactions-between-clusters"></a>
</h4>
<p>Beyond the aggregated degree of signaling between cell types, the degrees of signaling through specific ligand-receptor interactions can be assessed. gene_network() provides a graph of linkages between active transcription factors in a cluster, the linked receptors in that cluster, and the possible ligands of these active recptors</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gene_network.html">gene_network</a></span><span class="op">(</span><span class="va">pbmc_dom</span>, clust <span class="op">=</span> <span class="st">'dendritic_cell'</span>, layout <span class="op">=</span> <span class="st">'grid'</span><span class="op">)</span></span></code></pre></div>
<p>New to Domino2, gene_network() can be used between two clusters to determine if any of the possible ligands for a given receptor are expressed by a putative outgoing signaling cluster.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gene_network.html">gene_network</a></span><span class="op">(</span><span class="va">pbmc_dom</span>, clust <span class="op">=</span> <span class="st">'dendritic_cell'</span>, OutgoingSignalingClust <span class="op">=</span> <span class="st">"CD14_monocyte"</span>,</span>
<span>              layout <span class="op">=</span> <span class="st">'grid'</span><span class="op">)</span></span></code></pre></div>
<p>A comprehensive assessment of ligand expression targeting active receptors on a given cluster can be assessed by incoming_signaling_heatmap().</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/incoming_signaling_heatmap.html">incoming_signaling_heatmap</a></span><span class="op">(</span><span class="va">pbmc_dom</span>, rec_clust <span class="op">=</span> <span class="st">'dendritic_cell'</span>, max_thresh <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span></code></pre></div>
<p>Another form of comprehensive ligand expression assessment is available for individual active receptors in the form of circos plots new to Domino2. The outer arcs correspond to clusters in the domino object with inner arcs representing each possible ligand of the plotted receptor. Arcs are drawn between ligands on a cell type and the receptor if the ligand is expressed above the specified threshold. Arc widths correspond to the mean express of the ligand by the cluster with the widest arc width scaling to the maximum expression of the ligand within the data.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/circos_ligand_receptor.html">circos_ligand_receptor</a></span><span class="op">(</span><span class="va">pbmc_dom</span>, receptor <span class="op">=</span> <span class="st">"CD74"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="continued-development">Continued Development<a class="anchor" aria-label="anchor" href="#continued-development"></a>
</h3>
<p>Since Domino2 is a package still in development, there are new functions and features in development. The github repository contains branches with other changes that are being implemented. Additionally, if you find any bugs, have further questions, or there are features you would like to request, please let us know <a href="https://github.com/FertigLab/domino_development/issues" class="external-link">here</a>.</p>
</div>
<div class="section level3">
<h3 id="section"></h3>
<div class="section level6">
<h6 id="vignette-build-info">Vignette build info:<a class="anchor" aria-label="anchor" href="#vignette-build-info"></a>
</h6>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sys.date</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Christopher Cherry, Jacob T Mitchell, Sushma Nagaraj.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
