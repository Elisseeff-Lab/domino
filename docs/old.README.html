<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Domino2 • domino2</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet"><script src="extra.js"></script><meta property="og:title" content="Domino2"><meta property="og:image" content="/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">domino2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="articles/domino2.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/domino_object_vignette.html">Interacting with Domino2 Objects</a>
    <a class="dropdown-item" href="articles/plotting_vignette.html">Plotting Functions and Options</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/FertigLab/domino_development/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.svg" class="logo" alt=""><h1>Domino2</h1>
      <small class="dont-index">Source: <a href="https://github.com/FertigLab/domino_development/blob/HEAD/old.README.md" class="external-link"><code>old.README.md</code></a></small>
    </div>

<div id="domino2" class="section level1">
<p>Domino2 is a tool for analysis of intra- and intercellular signaling in single cell RNA sequencing data based on transcription factor activation and ligand and receptor signaling.</p>
<div class="section level3">
<h3 id="fertig-lab-development-branch">Fertig Lab Development Branch<a class="anchor" aria-label="anchor" href="#fertig-lab-development-branch"></a></h3>
<p>This repository is intended for integration of updates to Domino2 from the Fertig Lab and Elisseeff Lab. The code may currently be unstable and is not currently recommended for use. If you would like to use Domino, please use the main repository hosted by the Elisseeff Lab at <a href="https://github.com/Elisseeff-Lab/domino" class="external-link uri">https://github.com/Elisseeff-Lab/domino</a>.</p>
<div class="section level5">
<h5 id="branch-notes">Branch notes:<a class="anchor" aria-label="anchor" href="#branch-notes"></a></h5>
<p>Code used in the version of Domino published in 2021 has been archived in the branch <code>domino_paper_archive</code>. Changes, issues and pull requests will be handled on the <code>master</code> branch for easy use and installation of the updated version.</p>
<p>Added an option to only use cells without receptor dropout when calculating Pearson correlation.</p>
</div>
<div class="section level5">
<h5 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a></h5>
<p>If you find Domino useful, please consider citing us.</p>
<p>Cherry C, Maestas DR, Han J, Andorko JI, Cahan P, Fertig EJ, Garmire LX, Elisseeff JH. Computational reconstruction of the signalling networks surrounding implanted biomaterials from single-cell transcriptomics. Nat Biomed Eng. 2021 Oct;5(10):1228-1238. doi: 10.1038/s41551-021-00770-5. Epub 2021 Aug 2. PMID: 34341534; PMCID: PMC9894531.</p>
<p>And make sure to cite SCENIC if you use it for your transcription factor scores.</p>
<p>Aibar, Sara, et al. “SCENIC: single-cell regulatory network inference and clustering.” Nature methods 14.11 (2017): 1083-1086.</p>
</div>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a></h2>
<p>Domino itself can be installed from the github repository.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(devtools)){</span>
<span id="cb1-2"><a href="#cb1-2"></a>    <span class="kw">install.packages</span>(<span class="st">'devtools'</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a>}</span>
<span id="cb1-4"><a href="#cb1-4"></a>devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">'Elisseeff-Lab/domino'</span>)</span></code></pre></div>
<p>Domino requires a ligand-receptor database. We use <a href="https://www.cellphonedb.org/downloads" class="external-link">cellphonedb</a>. Domino will look for four files: complexes.csv genes.csv interactions.csv and proteins.csv. If you would like to download them through terminal the commands are below.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>raw.githubusercontent.com<span class="op">/</span>Teichlab<span class="op">/</span>cellphonedb<span class="op">-</span>data<span class="op">/</span>master<span class="op">/</span>data<span class="op">/</span>sources<span class="op">/</span>complex_curated.csv</span>
<span id="cb2-2"><a href="#cb2-2"></a>mv complex_curated.csv complexes.csv</span>
<span id="cb2-3"><a href="#cb2-3"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>raw.githubusercontent.com<span class="op">/</span>Teichlab<span class="op">/</span>cellphonedb<span class="op">-</span>data<span class="op">/</span>master<span class="op">/</span>data<span class="op">/</span>sources<span class="op">/</span>interaction_curated.csv</span>
<span id="cb2-4"><a href="#cb2-4"></a>mv interaction_curated.csv interactions.csv</span>
<span id="cb2-5"><a href="#cb2-5"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>raw.githubusercontent.com<span class="op">/</span>Teichlab<span class="op">/</span>cellphonedb<span class="op">-</span>data<span class="op">/</span>master<span class="op">/</span>data<span class="op">/</span>sources<span class="op">/</span>protein_curated.csv</span>
<span id="cb2-6"><a href="#cb2-6"></a>mv protein_curated.csv proteins.csv</span>
<span id="cb2-7"><a href="#cb2-7"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>raw.githubusercontent.com<span class="op">/</span>Teichlab<span class="op">/</span>cellphonedb<span class="op">-</span>data<span class="op">/</span>master<span class="op">/</span>data<span class="op">/</span>gene_input.csv</span>
<span id="cb2-8"><a href="#cb2-8"></a>mv gene_input.csv genes.csv</span></code></pre></div>
<div class="section level5">
<h5 id="setting-up-scenic">Setting up SCENIC<a class="anchor" aria-label="anchor" href="#setting-up-scenic"></a></h5>
<p>If you choose to use SCENIC to generate transcription factor activation scores, I would recommend the Python implementation. It’s significantly faster than the R version and SCENIC is the longest part of the analysis pipeline by far. Docker/Singularity images are available <a href="https://pyscenic.readthedocs.io/en/latest/" class="external-link">here</a>.</p>
<p>In the tutorials, we use a bash script that we wrote to run SCENIC with their Docker image. You’ll need to set up your environment properly if you wish to use our script to run SCENIC. First, you will need the docker image for SCENIC 0.10.0. The Docker image will need a directory to pull input files from and write output files to. By default, we use ~/docker_scratch, but feel free to make it whatever you like and change the directory variable in the bash script.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>mkdir <span class="op">~</span><span class="er">/</span>docker_scratch</span></code></pre></div>
<p>Put all of the following reference files in the scratch folder if you are using our script.</p>
<p>SCENIC requires a list of <a href="https://github.com/aertslab/pySCENIC/tree/master/resources" class="external-link">transcription factors</a>, <a href="https://resources.aertslab.org/cistarget/motif2tf/" class="external-link">motif annotations</a>, and <a href="https://resources.aertslab.org/cistarget/" class="external-link">cisTarget motifs</a> which are all available from the authors of SCENIC for human (HGNC), mouse (MGI), and fly. The following will download everything necessary for an analysis of a data set with MGI gene labels for the mm9 genome.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>raw.githubusercontent.com<span class="op">/</span>aertslab<span class="op">/</span>pySCENIC<span class="op">/</span>master<span class="op">/</span>resources<span class="op">/</span>mm_mgi_tfs.txt</span>
<span id="cb4-2"><a href="#cb4-2"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>resources.aertslab.org<span class="op">/</span>cistarget<span class="op">/</span>motif2tf<span class="op">/</span>motifs<span class="op">-</span>v9<span class="op">-</span>nr.mgi<span class="op">-</span>m0<span class="fl">.001</span><span class="op">-</span>o0.<span class="fl">0.</span>tbl</span>
<span id="cb4-3"><a href="#cb4-3"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>resources.aertslab.org<span class="op">/</span>cistarget<span class="op">/</span>databases<span class="op">/</span>mus_musculus<span class="op">/</span>mm9<span class="op">/</span>refseq_r45<span class="op">/</span>mc9nr<span class="op">/</span>gene_based<span class="op">/</span>mm9<span class="op">-</span>500bp<span class="op">-</span>upstream<span class="op">-</span>7species.mc9nr.feather</span>
<span id="cb4-4"><a href="#cb4-4"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>resources.aertslab.org<span class="op">/</span>cistarget<span class="op">/</span>databases<span class="op">/</span>mus_musculus<span class="op">/</span>mm9<span class="op">/</span>refseq_r45<span class="op">/</span>mc9nr<span class="op">/</span>gene_based<span class="op">/</span>mm9<span class="op">-</span>500bp<span class="op">-</span>upstream<span class="op">-</span>10species.mc9nr.feather</span>
<span id="cb4-5"><a href="#cb4-5"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>resources.aertslab.org<span class="op">/</span>cistarget<span class="op">/</span>databases<span class="op">/</span>mus_musculus<span class="op">/</span>mm9<span class="op">/</span>refseq_r45<span class="op">/</span>mc9nr<span class="op">/</span>gene_based<span class="op">/</span>mm9<span class="op">-</span>tss<span class="op">-</span>centered<span class="op">-</span>10kb<span class="op">-</span>7species.mc9nr.feather</span>
<span id="cb4-6"><a href="#cb4-6"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>resources.aertslab.org<span class="op">/</span>cistarget<span class="op">/</span>databases<span class="op">/</span>mus_musculus<span class="op">/</span>mm9<span class="op">/</span>refseq_r45<span class="op">/</span>mc9nr<span class="op">/</span>gene_based<span class="op">/</span>mm9<span class="op">-</span>tss<span class="op">-</span>centered<span class="op">-</span>10kb<span class="op">-</span>10species.mc9nr.feather</span>
<span id="cb4-7"><a href="#cb4-7"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>resources.aertslab.org<span class="op">/</span>cistarget<span class="op">/</span>databases<span class="op">/</span>mus_musculus<span class="op">/</span>mm9<span class="op">/</span>refseq_r45<span class="op">/</span>mc9nr<span class="op">/</span>gene_based<span class="op">/</span>mm9<span class="op">-</span>tss<span class="op">-</span>centered<span class="op">-</span>5kb<span class="op">-</span>7species.mc9nr.feather</span>
<span id="cb4-8"><a href="#cb4-8"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>resources.aertslab.org<span class="op">/</span>cistarget<span class="op">/</span>databases<span class="op">/</span>mus_musculus<span class="op">/</span>mm9<span class="op">/</span>refseq_r45<span class="op">/</span>mc9nr<span class="op">/</span>gene_based<span class="op">/</span>mm9<span class="op">-</span>tss<span class="op">-</span>centered<span class="op">-</span>5kb<span class="op">-</span>10species.mc9nr.feather</span></code></pre></div>
<p>And this is for HGNC gene labels for the hg19 genome</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>raw.githubusercontent.com<span class="op">/</span>aertslab<span class="op">/</span>pySCENIC<span class="op">/</span>master<span class="op">/</span>resources<span class="op">/</span>hs_hgnc_curated_tfs.txt</span>
<span id="cb5-2"><a href="#cb5-2"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>resources.aertslab.org<span class="op">/</span>cistarget<span class="op">/</span>motif2tf<span class="op">/</span>motifs<span class="op">-</span>v9<span class="op">-</span>nr.hgnc<span class="op">-</span>m0<span class="fl">.001</span><span class="op">-</span>o0.<span class="fl">0.</span>tbl</span>
<span id="cb5-3"><a href="#cb5-3"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>resources.aertslab.org<span class="op">/</span>cistarget<span class="op">/</span>databases<span class="op">/</span>homo_sapiens<span class="op">/</span>hg19<span class="op">/</span>refseq_r45<span class="op">/</span>mc9nr<span class="op">/</span>gene_based<span class="op">/</span>hg19<span class="op">-</span>500bp<span class="op">-</span>upstream<span class="op">-</span>7species.mc9nr.feather</span>
<span id="cb5-4"><a href="#cb5-4"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>resources.aertslab.org<span class="op">/</span>cistarget<span class="op">/</span>databases<span class="op">/</span>homo_sapiens<span class="op">/</span>hg19<span class="op">/</span>refseq_r45<span class="op">/</span>mc9nr<span class="op">/</span>gene_based<span class="op">/</span>hg19<span class="op">-</span>500bp<span class="op">-</span>upstream<span class="op">-</span>10species.mc9nr.feather</span>
<span id="cb5-5"><a href="#cb5-5"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>resources.aertslab.org<span class="op">/</span>cistarget<span class="op">/</span>databases<span class="op">/</span>homo_sapiens<span class="op">/</span>hg19<span class="op">/</span>refseq_r45<span class="op">/</span>mc9nr<span class="op">/</span>gene_based<span class="op">/</span>hg19<span class="op">-</span>tss<span class="op">-</span>centered<span class="op">-</span>10kb<span class="op">-</span>7species.mc9nr.feather</span>
<span id="cb5-6"><a href="#cb5-6"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>resources.aertslab.org<span class="op">/</span>cistarget<span class="op">/</span>databases<span class="op">/</span>homo_sapiens<span class="op">/</span>hg19<span class="op">/</span>refseq_r45<span class="op">/</span>mc9nr<span class="op">/</span>gene_based<span class="op">/</span>hg19<span class="op">-</span>tss<span class="op">-</span>centered<span class="op">-</span>10kb<span class="op">-</span>10species.mc9nr.feather</span>
<span id="cb5-7"><a href="#cb5-7"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>resources.aertslab.org<span class="op">/</span>cistarget<span class="op">/</span>databases<span class="op">/</span>homo_sapiens<span class="op">/</span>hg19<span class="op">/</span>refseq_r45<span class="op">/</span>mc9nr<span class="op">/</span>gene_based<span class="op">/</span>hg19<span class="op">-</span>tss<span class="op">-</span>centered<span class="op">-</span>5kb<span class="op">-</span>7species.mc9nr.feather</span>
<span id="cb5-8"><a href="#cb5-8"></a>curl <span class="op">-</span>O https<span class="op">:</span><span class="er">//</span>resources.aertslab.org<span class="op">/</span>cistarget<span class="op">/</span>databases<span class="op">/</span>homo_sapiens<span class="op">/</span>hg19<span class="op">/</span>refseq_r45<span class="op">/</span>mc9nr<span class="op">/</span>gene_based<span class="op">/</span>hg19<span class="op">-</span>tss<span class="op">-</span>centered<span class="op">-</span>5kb<span class="op">-</span>10species.mc9nr.feather</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="a-complete-basic-analysis-using-domino">A complete basic analysis using Domino<a class="anchor" aria-label="anchor" href="#a-complete-basic-analysis-using-domino"></a></h2>
<p>We will run through a complete analysis with Domino picking up from phenotypic assignment of clusters. If you would like to see an example of Domino without using clusters check out the cluster free analysis vignette <a href="https://github.com/Elisseeff-Lab/domino/vignettes" class="external-link">here</a>.</p>
<p>First we will need to get some data. <a href="https://www.dropbox.com/s/63gnlw45jf7cje8/pbmc3k_final.rds?dl=1" class="external-link">Here</a> is a Seurat object which contains cluster assignments from the Seurat 2,700 PBMC tutorial. You wont need to install Seurat if you don’t have it already - we are just pulling data from the object. We will create a directory to put our stuff as well.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>mkdir <span class="op">~</span><span class="er">/</span>work<span class="op">/</span>domino_basic_example</span></code></pre></div>
<div class="section level5">
<h5 id="running-scenic">Running SCENIC<a class="anchor" aria-label="anchor" href="#running-scenic"></a></h5>
<p>The first step is to generate transcription factor activation scores with SCENIC. To following along, you will need to have created a Docker scratch directory and downloaded the necessary HGNC reference files as described in the <strong>Setting up SCENIC</strong> section above. First we will need to write the counts file into the Docker temporary directory from R.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>ser =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">'pbmc3k_final.rds'</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">write.table</span>(<span class="kw">t</span>(<span class="kw">as.matrix</span>(ser<span class="op">@</span>assays<span class="op">$</span>RNA<span class="op">@</span>counts)), <span class="st">'~/docker_scratch/counts.tsv'</span>, </span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="dt">sep =</span> <span class="st">'</span><span class="ch">\t</span><span class="st">'</span>, <span class="dt">col.names =</span> <span class="ot">NA</span>)</span></code></pre></div>
<p>Now we simply need to run the SCENIC bash script for data with MGI symbols. For this data set on a 32-core EPYC Rome 7002 running this step takes 40m. If you would like to skip this step, the necessary output files are provided <a href="https://www.dropbox.com/s/m4wnir4x73vpfhe/basic_analysis_scenic_outputs.zip?dl=0" class="external-link">here</a>. Either way, move the files into your working directory by terminal or file explorer.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>bash <span class="op">~</span><span class="er">/</span>my_software<span class="op">/</span>domino<span class="op">/</span>scenic_bash<span class="op">/</span>hgnc_scenic.sh</span>
<span id="cb8-2"><a href="#cb8-2"></a>mv <span class="op">~</span><span class="er">/</span>docker_scratch<span class="op">/</span>auc_mtx.csv <span class="op">~</span><span class="er">/</span>work<span class="op">/</span>domino_basic_example</span>
<span id="cb8-3"><a href="#cb8-3"></a>mv <span class="op">~</span><span class="er">/</span>docker_scratch<span class="op">/</span>regulons.csv <span class="op">~</span><span class="er">/</span>work<span class="op">/</span>domino_basic_example</span></code></pre></div>
</div>
<div class="section level5">
<h5 id="creating-the-domino-object">Creating the domino object<a class="anchor" aria-label="anchor" href="#creating-the-domino-object"></a></h5>
<p>Now that we have the SCENIC data we can run domino. For example’s sake, we will pull all the necessary information from the Seurat object first but you can also simply provide the Seurat object to create_domino and the function will pull it out. We will also read in the AUC matrix from SCENIC. Note that it must be transposed from SCENIC’s output.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">library</span>(domino)</span>
<span id="cb9-2"><a href="#cb9-2"></a>ser =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">'pbmc3k_final.rds'</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a>counts =<span class="st"> </span>ser<span class="op">@</span>assays<span class="op">$</span>RNA<span class="op">@</span>counts</span>
<span id="cb9-4"><a href="#cb9-4"></a>z_scores =<span class="st"> </span>ser<span class="op">@</span>assays<span class="op">$</span>RNA<span class="op">@</span>scale.data</span>
<span id="cb9-5"><a href="#cb9-5"></a>clusters =<span class="st"> </span>ser<span class="op">@</span>active.ident</span>
<span id="cb9-6"><a href="#cb9-6"></a>auc =<span class="st"> </span><span class="kw">t</span>(<span class="kw">read.table</span>(<span class="st">'auc_mtx.csv'</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">row.names =</span> <span class="dv">1</span>, </span>
<span id="cb9-7"><a href="#cb9-7"></a>    <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>, <span class="dt">sep =</span> <span class="st">','</span>))</span></code></pre></div>
<p>This command generates the domino object and prepares it (compiles the LR database, calculates cluster TF enrichment, and calculates TF - R correlation). Make sure you put the correct directory for the cellphonedb data sets in.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>pbmc_dom =<span class="st"> </span><span class="kw">create_domino</span>(<span class="dt">signaling_db =</span> <span class="st">'~/work/ref/human/cpdb/'</span>, </span>
<span id="cb10-2"><a href="#cb10-2"></a>    <span class="dt">features =</span> auc, <span class="dt">counts =</span> counts, <span class="dt">z_scores =</span> z_scores, <span class="dt">clusters =</span> clusters, </span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="dt">df =</span> <span class="st">'regulons.csv'</span>)</span></code></pre></div>
</div>
<div class="section level5">
<h5 id="building-the-signaling-network-and-plotting-options">Building the signaling network and plotting options<a class="anchor" aria-label="anchor" href="#building-the-signaling-network-and-plotting-options"></a></h5>
<p>There are four major parameters you can play with when buidling the signaling network, two for selecting TFs for each cluster and two for connecting TFs to recs. min_tf_pval is the minimum p val for a TF to be assigned to a cluster and max_tf_per_clust is the maximum number of transcription factors allowed in each cluster. The same patter is true for rec_tf_cor_threshold and max_rec_per_tf except the thresholding is on the Pearon correlation between receptor and transcription factor. Building the signaling network takes very little time so feel free to play around with these values. In general we prefer to select a pval and cor threshold such that a good portion of the TFs and recs are not being trimmed by the maximum number thresholds.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>pbmc_dom =<span class="st"> </span><span class="kw">build_domino</span>(pbmc_dom, <span class="dt">max_tf_per_clust =</span> <span class="dv">10</span>, </span>
<span id="cb11-2"><a href="#cb11-2"></a>    <span class="dt">min_tf_pval =</span> <span class="fl">.001</span>, <span class="dt">max_rec_per_tf =</span> <span class="dv">10</span>, <span class="dt">rec_tf_cor_threshold =</span> <span class="fl">.25</span>)</span></code></pre></div>
<p>Now we just need to visualize the signaling network. First, we visualize the cluster-cluster signaling with signaling_network. We are using a max threshold here (max_thresh) because the Mk cluster’s expression of ITGA2B is so much higher than the other clusters/ligands it drowns other relevant signaling out. Give it a shot without the max_thresh and you’ll see what I mean.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">signaling_network</span>(pbmc_dom, <span class="dt">edge_weight =</span> <span class="fl">.5</span>, <span class="dt">max_thresh =</span> <span class="fl">2.5</span>)</span></code></pre></div>
<div class="figure">
<img src="https://github.com/Elisseeff-Lab/domino/blob/cc_working/readme_images/intercluster_network.png" alt=""><p class="caption">Intercluster signaling network</p>
</div>
<p>By default, the nodes are scaled based on expression of ligands targetting them. They are larger if cells in the data set are expressing high amounts of ligands targetting the cluster. The edges are weighted based on the strength of signaling between two specific clusters. The color of the edge will match the color of the ligand cluster. For example, in the network above the teal line connecting CD8 T cells and DCs represents signaling <em>from</em> T cells <em>to</em> DCs. In order to determine the ligand-receptor-TF signaling patterns involved in that, we can zoom in on the gene network in the DCs.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">gene_network</span>(pbmc_dom, <span class="dt">clust =</span> <span class="st">'DC'</span>, <span class="dt">layout =</span> <span class="st">'fr'</span>)</span></code></pre></div>
<div class="figure">
<img src="https://github.com/Elisseeff-Lab/domino/blob/cc_working/readme_images/DC_network.png" alt=""><p class="caption">DC gene network</p>
</div>
<p>By default red nodes are ligands, blue are receptors, and green are transcription factors. Now lets look at the expression of the ligands that are targetting the DCs.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">incoming_signaling_heatmap</span>(pbmc_dom, <span class="dt">rec_clust =</span> <span class="st">'DC'</span>, <span class="dt">max_thresh =</span> <span class="fl">2.5</span>)</span></code></pre></div>
<div class="figure">
<img src="https://github.com/Elisseeff-Lab/domino/blob/cc_working/readme_images/DC_signaling_heatmap.png" alt=""><p class="caption">DC incoming signaling heatmap</p>
</div>
<p>It looks like CCL5 is a major component of the signaling from T cells to DCs. From the gene network above it looks like the CCL5 is predicted to target LILRB1 and would activate IRF4 and IRF8 in the DCs. We can investigate some expression patterns associated with these linkages. First, lets generate a heatmap of the transcription factor activation scores.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">feat_heatmap</span>(pbmc_dom, <span class="dt">norm =</span> <span class="ot">TRUE</span>, <span class="dt">bool =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div class="figure">
<img src="https://github.com/Elisseeff-Lab/domino/blob/cc_working/readme_images/tfas_heatmap.png" alt=""><p class="caption">Transcription factor activation score heatmap</p>
</div>
<p>And to look at the connections between transcription factors and receptores we can create a heatmap of correlations between the two.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">cor_heatmap</span>(pbmc_dom, <span class="dt">bool =</span> <span class="ot">FALSE</span>, <span class="dt">mark_connections =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="figure">
<img src="https://github.com/Elisseeff-Lab/domino/blob/cc_working/readme_images/cor_heatmap.png" alt=""><p class="caption">Rec-TF correlation heatmap</p>
</div>
<p>Finally, you can visualize the entire tf-r-l network by including all clusters with gene_network. Note that the function will return the igraph object used to make the plot. This is important if you use a force directed layout and you would like to make two versions of the same plot. Here we will use default settings to allow us to see node labels and then reformat the plot with igraph options to make it less cluttered for smaller formats.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>info =<span class="st"> </span><span class="kw">gene_network</span>(pbmc_dom, <span class="dt">clust =</span> <span class="kw">levels</span>(pbmc_dom<span class="op">@</span>clusters), </span>
<span id="cb17-2"><a href="#cb17-2"></a>    <span class="dt">lig_scale =</span> <span class="ot">FALSE</span>, <span class="dt">layout =</span> <span class="st">'fr'</span>)</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="kw">plot</span>(info<span class="op">$</span>graph, <span class="dt">layout =</span> info<span class="op">$</span>layout, <span class="dt">vertex.size =</span> <span class="dv">3</span>, <span class="dt">edge.color =</span> <span class="st">'grey'</span>, </span>
<span id="cb17-4"><a href="#cb17-4"></a>    <span class="dt">vertex.frame.color =</span> <span class="st">'black'</span>, <span class="dt">vertex.label =</span> <span class="ot">NA</span>)</span></code></pre></div>
<p><img src="https://github.com/Elisseeff-Lab/domino/blob/cc_working/readme_images/global_network_default.png" alt="Default global network"><img src="https://github.com/Elisseeff-Lab/domino/blob/cc_working/readme_images/global_network_tweaked.png" alt="Tweaked global network"></p>
<p>Thanks for taking a look at our software. If you have any questions please let us know <a href="https://github.com/Elisseeff-Lab/domino/issues" class="external-link">here</a>.</p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by .</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

